<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Muthukrishnan">

<title>pymongo - Documentation – Technical Manuals</title>
<style>
html {
  color: #1a1a1a;
  background-color: #fdfdfd;
}
body {
  margin: 0 auto;
  max-width: 36em;
  padding-left: 50px;
  padding-right: 50px;
  padding-top: 50px;
  padding-bottom: 50px;
  hyphens: auto;
  overflow-wrap: break-word;
  text-rendering: optimizeLegibility;
  font-kerning: normal;
}
@media (max-width: 600px) {
  body {
    font-size: 0.9em;
    padding: 12px;
  }
  h1 {
    font-size: 1.8em;
  }
}
@media print {
  html {
    background-color: white;
  }
  body {
    background-color: transparent;
    color: black;
    font-size: 12pt;
  }
  p, h2, h3 {
    orphans: 3;
    widows: 3;
  }
  h2, h3, h4 {
    page-break-after: avoid;
  }
}
p {
  margin: 1em 0;
}
a {
  color: #1a1a1a;
}
a:visited {
  color: #1a1a1a;
}
img {
  max-width: 100%;
}
svg {
  height; auto;
  max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
  margin-top: 1.4em;
}
h5, h6 {
  font-size: 1em;
  font-style: italic;
}
h6 {
  font-weight: normal;
}
ol, ul {
  padding-left: 1.7em;
  margin-top: 1em;
}
li > ol, li > ul {
  margin-top: 0;
}
ul > li:not(:has(> p)) > ul,
ol > li:not(:has(> p)) > ul,
ul > li:not(:has(> p)) > ol,
ol > li:not(:has(> p)) > ol {
  margin-bottom: 0;
}
ul > li:not(:has(> p)) > ul > li:has(> p),
ol > li:not(:has(> p)) > ul > li:has(> p),
ul > li:not(:has(> p)) > ol > li:has(> p),
ol > li:not(:has(> p)) > ol > li:has(> p) {
  margin-top: 1rem;
}
blockquote {
  margin: 1em 0 1em 1.7em;
  padding-left: 1em;
  border-left: 2px solid #e6e6e6;
  color: #606060;
}
code {
  font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
  font-size: 85%;
  margin: 0;
  hyphens: manual;
}
pre {
  margin: 1em 0;
  overflow: auto;
}
pre code {
  padding: 0;
  overflow: visible;
  overflow-wrap: normal;
}
.sourceCode {
 background-color: transparent;
 overflow: visible;
}
hr {
  background-color: #1a1a1a;
  border: none;
  height: 1px;
  margin: 1em 0;
}
table {
  margin: 1em 0;
  border-collapse: collapse;
  width: 100%;
  overflow-x: auto;
  display: block;
  font-variant-numeric: lining-nums tabular-nums;
}
table caption {
  margin-bottom: 0.75em;
}
tbody {
  margin-top: 0.5em;
  border-top: 1px solid #1a1a1a;
  border-bottom: 1px solid #1a1a1a;
}
th {
  border-top: 1px solid #1a1a1a;
  padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
  padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
  margin-bottom: 4em;
  text-align: center;
}
#TOC li {
  list-style: none;
}
#TOC ul {
  padding-left: 1.3em;
}
#TOC > ul {
  padding-left: 0;
}
#TOC a:not(:hover) {
  text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<link href="../../favicon.ico" rel="icon">
<script async="" src="https://www.googletagmanager.com/gtag/js?id="></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '', { 'anonymize_ip': true});
</script>
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<meta property="og:title" content="pymongo - Documentation – Technical Manuals">
<meta property="og:site_name" content="Technical Manuals">
</head><body><div class="navigation-header">
    <nav>
        <div>
            <div class="logo">
                <a href="../../" aria-label="Home">
                    <span>Technical Manuals - Home</span>
                </a>
            </div>
            <div class="nav-menu">
                <ul>
                    <li>
                        <a href="../../about.html">
                            <span class="menu-text">About</span>
                        </a>
                    </li>
                    <li> 
                        <a href="https://github.com/muthuspark" target="_blank">
                            <span class="menu-text">Github</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://linkedin.com/in/krimuthu" target="_blank">
                            <span class="menu-text">Linkedin</span>
                        </a>
                    </li>
                    <li>
                        <button onclick="window.print()" class="print-button">
                            <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M6 9V2h12v7"></path>
                              <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"></path>
                              <path d="M6 14h12v8H6z"></path>
                            </svg>
                            Print Page
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>


<link rel="stylesheet" href="../../styles.css">





<header id="title-block-header">
<h1 class="title">pymongo - Documentation</h1>

</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-pymongo" id="toc-what-is-pymongo">What is PyMongo?</a></li>
  <li><a href="#setting-up-pymongo" id="toc-setting-up-pymongo">Setting up PyMongo</a></li>
  <li><a href="#connecting-to-mongodb" id="toc-connecting-to-mongodb">Connecting to MongoDB</a></li>
  <li><a href="#example-basic-connection-and-database-interaction" id="toc-example-basic-connection-and-database-interaction">Example: Basic Connection and Database Interaction</a></li>
  <li><a href="#working-with-databases-and-collections" id="toc-working-with-databases-and-collections">Working with Databases and Collections</a>
  <ul>
  <li><a href="#creating-databases" id="toc-creating-databases">Creating Databases</a></li>
  <li><a href="#listing-databases" id="toc-listing-databases">Listing Databases</a></li>
  <li><a href="#dropping-databases" id="toc-dropping-databases">Dropping Databases</a></li>
  <li><a href="#accessing-collections" id="toc-accessing-collections">Accessing Collections</a></li>
  <li><a href="#creating-collections" id="toc-creating-collections">Creating Collections</a></li>
  <li><a href="#listing-collections" id="toc-listing-collections">Listing Collections</a></li>
  <li><a href="#dropping-collections" id="toc-dropping-collections">Dropping Collections</a></li>
  <li><a href="#example-database-and-collection-management" id="toc-example-database-and-collection-management">Example: Database and Collection Management</a></li>
  </ul></li>
  <li><a href="#document-manipulation" id="toc-document-manipulation">Document Manipulation</a>
  <ul>
  <li><a href="#inserting-documents" id="toc-inserting-documents">Inserting Documents</a></li>
  <li><a href="#finding-documents" id="toc-finding-documents">Finding Documents</a></li>
  <li><a href="#updating-documents" id="toc-updating-documents">Updating Documents</a></li>
  <li><a href="#deleting-documents" id="toc-deleting-documents">Deleting Documents</a></li>
  <li><a href="#example-crud-operations" id="toc-example-crud-operations">Example: CRUD Operations</a></li>
  </ul></li>
  <li><a href="#advanced-queries" id="toc-advanced-queries">Advanced Queries</a>
  <ul>
  <li><a href="#query-operators" id="toc-query-operators">Query Operators</a></li>
  <li><a href="#filtering-documents-with-query-operators" id="toc-filtering-documents-with-query-operators">Filtering Documents with Query Operators</a></li>
  <li><a href="#sorting-documents" id="toc-sorting-documents">Sorting Documents</a></li>
  <li><a href="#pagination-and-limiting-results" id="toc-pagination-and-limiting-results">Pagination and Limiting Results</a></li>
  <li><a href="#projection" id="toc-projection">Projection</a></li>
  <li><a href="#example-advanced-query-techniques" id="toc-example-advanced-query-techniques">Example: Advanced Query Techniques</a></li>
  </ul></li>
  <li><a href="#aggregation-framework" id="toc-aggregation-framework">Aggregation Framework</a>
  <ul>
  <li><a href="#introduction-to-aggregation" id="toc-introduction-to-aggregation">Introduction to Aggregation</a></li>
  <li><a href="#aggregation-pipeline-stages" id="toc-aggregation-pipeline-stages">Aggregation Pipeline Stages</a></li>
  <li><a href="#match" id="toc-match">$match</a></li>
  <li><a href="#project" id="toc-project">$project</a></li>
  <li><a href="#group" id="toc-group">$group</a></li>
  <li><a href="#sort" id="toc-sort">$sort</a></li>
  <li><a href="#limit" id="toc-limit">$limit</a></li>
  <li><a href="#unwind" id="toc-unwind">$unwind</a></li>
  <li><a href="#example-aggregation-framework-usage" id="toc-example-aggregation-framework-usage">Example: Aggregation Framework Usage</a></li>
  </ul></li>
  <li><a href="#data-modeling" id="toc-data-modeling">Data Modeling</a>
  <ul>
  <li><a href="#choosing-the-right-data-model" id="toc-choosing-the-right-data-model">Choosing the Right Data Model</a></li>
  <li><a href="#embedded-documents-vs.-referencing" id="toc-embedded-documents-vs.-referencing">Embedded Documents vs.&nbsp;Referencing</a></li>
  <li><a href="#data-normalization" id="toc-data-normalization">Data Normalization</a></li>
  </ul></li>
  <li><a href="#transactions" id="toc-transactions">Transactions</a>
  <ul>
  <li><a href="#introduction-to-transactions-in-mongodb" id="toc-introduction-to-transactions-in-mongodb">Introduction to Transactions in MongoDB</a></li>
  <li><a href="#using-transactions-with-pymongo" id="toc-using-transactions-with-pymongo">Using Transactions with PyMongo</a></li>
  <li><a href="#example-transaction-management" id="toc-example-transaction-management">Example: Transaction Management</a></li>
  </ul></li>
  <li><a href="#error-handling-and-best-practices" id="toc-error-handling-and-best-practices">Error Handling and Best Practices</a>
  <ul>
  <li><a href="#common-errors-and-solutions" id="toc-common-errors-and-solutions">Common Errors and Solutions</a></li>
  <li><a href="#best-practices-for-database-design" id="toc-best-practices-for-database-design">Best Practices for Database Design</a></li>
  <li><a href="#connection-pooling-and-management" id="toc-connection-pooling-and-management">Connection Pooling and Management</a></li>
  <li><a href="#security-considerations" id="toc-security-considerations">Security Considerations</a></li>
  </ul></li>
  <li><a href="#working-with-gridfs" id="toc-working-with-gridfs">Working with GridFS</a>
  <ul>
  <li><a href="#storing-and-retrieving-files" id="toc-storing-and-retrieving-files">Storing and Retrieving Files</a></li>
  <li><a href="#chunking-and-file-management" id="toc-chunking-and-file-management">Chunking and File Management</a></li>
  </ul></li>
  <li><a href="#working-with-mongodb-atlas" id="toc-working-with-mongodb-atlas">Working with MongoDB Atlas</a>
  <ul>
  <li><a href="#connecting-to-atlas" id="toc-connecting-to-atlas">Connecting to Atlas</a></li>
  <li><a href="#using-atlas-features" id="toc-using-atlas-features">Using Atlas Features</a></li>
  <li><a href="#managing-your-atlas-cluster" id="toc-managing-your-atlas-cluster">Managing your Atlas Cluster</a></li>
  </ul></li>
  <li><a href="#appendix-pymongo-api-reference" id="toc-appendix-pymongo-api-reference">Appendix: PyMongo API Reference</a>
  <ul>
  <li><a href="#client" id="toc-client">Client</a></li>
  <li><a href="#database" id="toc-database">Database</a></li>
  <li><a href="#collection" id="toc-collection">Collection</a></li>
  <li><a href="#cursor" id="toc-cursor">Cursor</a></li>
  <li><a href="#helper-functions" id="toc-helper-functions">Helper Functions</a></li>
  </ul></li>
  </ul>
</nav>
<h3 id="what-is-pymongo">What is PyMongo?</h3>
<p>PyMongo is the official Python driver for MongoDB. It provides a comprehensive and easy-to-use interface for interacting with MongoDB databases from your Python applications. PyMongo allows you to perform all standard database operations, including inserting, querying, updating, and deleting documents, as well as managing collections and databases. It supports various features like connection pooling, authentication, and more advanced functionalities such as aggregations and map-reduce operations. Its design prioritizes ease of use and close adherence to MongoDB’s capabilities.</p>
<h3 id="setting-up-pymongo">Setting up PyMongo</h3>
<p>To use PyMongo, you first need to install it. The easiest way is using <code>pip</code>, Python’s package installer:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pymongo</span></code></pre></div>
<p>This command will download and install the latest stable version of PyMongo. Ensure you have a compatible version of Python (typically 3.7 or later) installed on your system. You might need administrator privileges (using <code>sudo</code> on Linux/macOS) to install packages globally. If you prefer a virtual environment for better project isolation, create one before running the <code>pip install</code> command. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> venv .venv  <span class="co"># Creates a virtual environment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> .venv/bin/activate  <span class="co"># Activates the virtual environment (Linux/macOS)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">.venv\Scripts\activate</span>  <span class="co"># Activates the virtual environment (Windows)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pymongo</span></code></pre></div>
<h3 id="connecting-to-mongodb">Connecting to MongoDB</h3>
<p>Connecting to a MongoDB server using PyMongo involves creating a <code>MongoClient</code> object. The constructor takes the connection string as an argument. This string typically specifies the hostname and port of the MongoDB server. A simple connection to a local MongoDB instance (running on the default port 27017) looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span></code></pre></div>
<p>For connections to remote servers or those requiring authentication, the connection string becomes more complex. For instance, to connect to a server at <code>mongodb.example.com</code> on port 27018 with username <code>user</code> and password <code>password</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://user:password@mongodb.example.com:27018/"</span>)</span></code></pre></div>
<p>Always refer to the official PyMongo documentation for detailed information on connection strings and advanced connection options.</p>
<h3 id="example-basic-connection-and-database-interaction">Example: Basic Connection and Database Interaction</h3>
<p>This example demonstrates a basic connection, database selection, collection creation, and document insertion:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the MongoDB server</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Access a database (creates it if it doesn't exist)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Access a collection (creates it if it doesn't exist)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert a document</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>document <span class="op">=</span> {<span class="st">"name"</span>: <span class="st">"Example Document"</span>, <span class="st">"value"</span>: <span class="dv">10</span>}</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>inserted_id <span class="op">=</span> collection.insert_one(document).inserted_id</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Inserted document with ID: </span><span class="sc">{</span>inserted_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Find a document</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>found_document <span class="op">=</span> collection.find_one({<span class="st">"name"</span>: <span class="st">"Example Document"</span>})</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found document: </span><span class="sc">{</span>found_document<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the connection</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>Remember to replace <code>"mongodb://localhost:27017/"</code> with your actual MongoDB connection string. This example showcases essential steps for interacting with a MongoDB database using PyMongo. For more advanced operations, consult the PyMongo documentation which covers topics such as querying with various operators, updating documents, and managing indexes.</p>
<h2 id="working-with-databases-and-collections">Working with Databases and Collections</h2>
<h3 id="creating-databases">Creating Databases</h3>
<p>MongoDB databases are created implicitly when you first insert a document into a collection within that database. You don’t need an explicit <code>CREATE DATABASE</code> command like in some other database systems. Attempting to access a database that doesn’t exist via PyMongo will create it if the first operation is a write operation (e.g., inserting a document).</p>
<p>For example, if you access <code>client["mydatabase"]</code> and then perform an insert operation on a collection within it, the <code>mydatabase</code> database will be created. However, be mindful that simply accessing <code>client["mydatabase"]</code> without performing any operations won’t create the database.</p>
<h3 id="listing-databases">Listing Databases</h3>
<p>To list all databases available to the connected user, use the <code>list_database_names()</code> method of the <code>MongoClient</code> object:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>database_names <span class="op">=</span> client.list_database_names()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(database_names)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This will return a list of strings, each representing the name of a database the user has access to.</p>
<h3 id="dropping-databases">Dropping Databases</h3>
<p>To delete a database, use the <code>drop_database()</code> method of the <code>MongoClient</code> object, providing the database name as an argument:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>client.drop_database(<span class="st">"mydatabase"</span>) <span class="co">#Deletes the database named 'mydatabase'</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This operation is irreversible, so use caution. Ensure you have correctly specified the database name.</p>
<h3 id="accessing-collections">Accessing Collections</h3>
<p>Collections are accessed through the database object. Similar to databases, collections are created implicitly when you insert a document into them. You access a collection using bracket notation with the collection name as a string:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]  <span class="co"># Accesses 'mycollection'; creates it if it doesn't exist.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="creating-collections">Creating Collections</h3>
<p>While collections are created automatically upon the first insertion, you can explicitly create a collection using the <code>create_collection()</code> method of the database object. This method allows for specifying additional options during creation (though typically not needed for simple cases). For instance, you might specify capped collections for specific scenarios.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>db.create_collection(<span class="st">"mynewcollection"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="listing-collections">Listing Collections</h3>
<p>To list all collections within a database, use the <code>list_collection_names()</code> method of the database object:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>collection_names <span class="op">=</span> db.list_collection_names()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(collection_names)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This returns a list of strings, each representing the name of a collection in the specified database.</p>
<h3 id="dropping-collections">Dropping Collections</h3>
<p>To delete a collection, use the <code>drop_collection()</code> method of the database object:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>db.drop_collection(<span class="st">"mycollection"</span>) <span class="co">#Deletes 'mycollection'</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This permanently removes the specified collection and all its documents.</p>
<h3 id="example-database-and-collection-management">Example: Database and Collection Management</h3>
<p>This example demonstrates creating, listing, and dropping databases and collections:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a database (implicitly by inserting into a collection)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>collection.insert_one({<span class="st">"x"</span>:<span class="dv">1</span>})</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># List databases</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>database_names <span class="op">=</span> client.list_database_names()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Databases:"</span>, database_names)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># List collections in the database</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>collection_names <span class="op">=</span> db.list_collection_names()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Collections:"</span>, collection_names)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create another collection explicitly</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>db.create_collection(<span class="st">"anothercollection"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>collection_names <span class="op">=</span> db.list_collection_names()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Collections after explicit creation:"</span>, collection_names)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop a collection</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>db.drop_collection(<span class="st">"mycollection"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the database</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>client.drop_database(<span class="st">"mydatabase"</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># List databases again (should not include 'mydatabase')</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>database_names <span class="op">=</span> client.list_database_names()</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Databases after dropping:"</span>, database_names)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This comprehensive example showcases the various methods for managing databases and collections in PyMongo. Remember to handle potential exceptions (e.g., <code>pymongo.errors.CollectionInvalid</code>) appropriately in production code.</p>
<h2 id="document-manipulation">Document Manipulation</h2>
<h3 id="inserting-documents">Inserting Documents</h3>
<p>PyMongo provides several ways to insert documents into a collection. The most common method uses the <code>insert_one()</code> method for inserting a single document and <code>insert_many()</code> for inserting multiple documents.</p>
<p><strong><code>insert_one()</code>:</strong> This method takes a single document (a Python dictionary) as an argument and returns an <code>InsertOneResult</code> object containing the inserted document’s ID.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>document <span class="op">=</span> {<span class="st">"name"</span>: <span class="st">"Document 1"</span>, <span class="st">"value"</span>: <span class="dv">1</span>}</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.insert_one(document)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>inserted_id <span class="op">=</span> result.inserted_id</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Inserted document ID: </span><span class="sc">{</span>inserted_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong><code>insert_many()</code>:</strong> This method accepts a list of documents and returns an <code>InsertManyResult</code> object containing a list of inserted IDs. The order of IDs in the result matches the order of documents in the input list.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> [</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Document 2"</span>, <span class="st">"value"</span>: <span class="dv">2</span>},</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Document 3"</span>, <span class="st">"value"</span>: <span class="dv">3</span>}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.insert_many(documents)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>inserted_ids <span class="op">=</span> result.inserted_ids</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Inserted document IDs: </span><span class="sc">{</span>inserted_ids<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="finding-documents">Finding Documents</h3>
<p>The primary method for retrieving documents is <code>find()</code>, which returns a cursor object. A cursor allows you to iterate through the results efficiently. <code>find_one()</code> retrieves a single document matching the query.</p>
<p><strong><code>find()</code>:</strong> This method takes a query document (a Python dictionary specifying the search criteria) as an argument. An empty query document <code>{}</code> returns all documents in the collection.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Find all documents</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> document <span class="kw">in</span> collection.find({}):</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(document)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Find documents where value is greater than 1</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> document <span class="kw">in</span> collection.find({<span class="st">"value"</span>: {<span class="st">"$gt"</span>: <span class="dv">1</span>}}):</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(document)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong><code>find_one()</code>:</strong> This method returns a single document matching the query. If multiple documents match, it returns only the first one. If no document matches, it returns <code>None</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>document <span class="op">=</span> collection.find_one({<span class="st">"name"</span>: <span class="st">"Document 2"</span>})</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(document)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="updating-documents">Updating Documents</h3>
<p>PyMongo provides <code>update_one()</code>, <code>update_many()</code>, and <code>replace_one()</code> for updating documents.</p>
<p><strong><code>update_one()</code>:</strong> Updates a single document matching the filter.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.update_one({<span class="st">"name"</span>: <span class="st">"Document 2"</span>}, {<span class="st">"$set"</span>: {<span class="st">"value"</span>: <span class="dv">22</span>}})</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Modified count: </span><span class="sc">{</span>result<span class="sc">.</span>modified_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong><code>update_many()</code>:</strong> Updates multiple documents matching the filter.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.update_many({<span class="st">"value"</span>: {<span class="st">"$gt"</span>: <span class="dv">10</span>}}, {<span class="st">"$inc"</span>: {<span class="st">"value"</span>: <span class="dv">1</span>}})</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Modified count: </span><span class="sc">{</span>result<span class="sc">.</span>modified_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong><code>replace_one()</code>:</strong> Replaces a single document entirely with a new document.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>new_document <span class="op">=</span> {<span class="st">"name"</span>: <span class="st">"Replaced Document"</span>, <span class="st">"value"</span>: <span class="dv">42</span>}</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.replace_one({<span class="st">"name"</span>: <span class="st">"Document 3"</span>}, new_document)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Modified count: </span><span class="sc">{</span>result<span class="sc">.</span>modified_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="deleting-documents">Deleting Documents</h3>
<p>PyMongo offers <code>delete_one()</code> and <code>delete_many()</code> for deleting documents.</p>
<p><strong><code>delete_one()</code>:</strong> Deletes a single document matching the filter.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.delete_one({<span class="st">"name"</span>: <span class="st">"Replaced Document"</span>})</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Deleted count: </span><span class="sc">{</span>result<span class="sc">.</span>deleted_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong><code>delete_many()</code>:</strong> Deletes all documents matching the filter.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> collection.delete_many({<span class="st">"value"</span>: {<span class="st">"$lt"</span>: <span class="dv">10</span>}})</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Deleted count: </span><span class="sc">{</span>result<span class="sc">.</span>deleted_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="example-crud-operations">Example: CRUD Operations</h3>
<p>This example demonstrates basic Create, Read, Update, and Delete (CRUD) operations:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>collection.insert_one({<span class="st">"item"</span>: <span class="st">"canvas"</span>, <span class="st">"qty"</span>: <span class="dv">100</span>, <span class="st">"size"</span>: {<span class="st">"h"</span>: <span class="dv">28</span>, <span class="st">"w"</span>: <span class="fl">35.5</span>, <span class="st">"uom"</span>: <span class="st">"cm"</span>}, <span class="st">"status"</span>: <span class="st">"A"</span>})</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>collection.insert_one({<span class="st">"item"</span>: <span class="st">"journal"</span>, <span class="st">"qty"</span>: <span class="dv">25</span>, <span class="st">"size"</span>: {<span class="st">"h"</span>: <span class="dv">14</span>, <span class="st">"w"</span>: <span class="dv">21</span>, <span class="st">"uom"</span>: <span class="st">"cm"</span>}, <span class="st">"status"</span>: <span class="st">"A"</span>})</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Read</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"status"</span>: <span class="st">"A"</span>}):</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Update</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>collection.update_one({<span class="st">"item"</span>: <span class="st">"journal"</span>}, {<span class="st">"$set"</span>: {<span class="st">"status"</span>: <span class="st">"P"</span>}})</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read after update</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"status"</span>: <span class="st">"P"</span>}):</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>collection.delete_many({<span class="st">"status"</span>: <span class="st">"A"</span>})</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Read after delete</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}):</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This example showcases common CRUD operations. For more advanced scenarios (like using various query operators or working with large datasets), refer to the complete PyMongo documentation. Remember to handle exceptions appropriately in production environments.</p>
<h2 id="advanced-queries">Advanced Queries</h2>
<h3 id="query-operators">Query Operators</h3>
<p>MongoDB provides a rich set of query operators that allow for flexible and powerful querying of documents. These operators are used within the query document passed to the <code>find()</code> method. Some common operators include:</p>
<ul>
<li><strong><code>$eq</code> (equality):</strong> Matches values exactly. <code>{"field": {"$eq": "value"}}</code></li>
<li><strong><code>$ne</code> (not equal):</strong> Matches values that are not equal to the specified value. <code>{"field": {"$ne": "value"}}</code></li>
<li><strong><code>$gt</code> (greater than):</strong> Matches values greater than the specified value. <code>{"field": {"$gt": 10}}</code></li>
<li><strong><code>$gte</code> (greater than or equal to):</strong> Matches values greater than or equal to the specified value. <code>{"field": {"$gte": 10}}</code></li>
<li><strong><code>$lt</code> (less than):</strong> Matches values less than the specified value. <code>{"field": {"$lt": 10}}</code></li>
<li><strong><code>$lte</code> (less than or equal to):</strong> Matches values less than or equal to the specified value. <code>{"field": {"$lte": 10}}</code></li>
<li><strong><code>$in</code>:</strong> Matches any of the values specified in an array. <code>{"field": {"$in": [1, 2, 3]}}</code></li>
<li><strong><code>$nin</code>:</strong> Matches none of the values specified in an array. <code>{"field": {"$nin": [1, 2, 3]}}</code></li>
<li><strong><code>$regex</code>:</strong> Matches values that match a regular expression. <code>{"field": {"$regex": "pattern"}}</code></li>
<li><strong><code>$exists</code>:</strong> Checks if a field exists in a document. <code>{"field": {"$exists": true}}</code></li>
<li><strong><code>$type</code>:</strong> Matches values of a specific BSON type.</li>
<li><strong><code>$and</code>, <code>$or</code>, <code>$not</code>:</strong> Logical operators for combining multiple query expressions.</li>
</ul>
<h3 id="filtering-documents-with-query-operators">Filtering Documents with Query Operators</h3>
<p>The query operators are used within the query document to filter documents based on various criteria. For example:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find documents where the 'value' field is greater than 10</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"value"</span>: {<span class="st">"$gt"</span>: <span class="dv">10</span>}}):</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Find documents where the 'name' field starts with "Doc"</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"name"</span>: {<span class="st">"$regex"</span>: <span class="st">"^Doc"</span>}}):</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Find documents where the 'status' field is either "A" or "P"</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"$or"</span>: [{<span class="st">"status"</span>: <span class="st">"A"</span>}, {<span class="st">"status"</span>: <span class="st">"P"</span>}]}):</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This illustrates how to use different query operators to filter documents based on various conditions. Remember to replace <code>"mongodb://localhost:27017/"</code> with your MongoDB connection string and ensure the <code>mydatabase</code> and <code>mycollection</code> exist and are populated.</p>
<h3 id="sorting-documents">Sorting Documents</h3>
<p>The <code>sort()</code> method of the cursor object is used to sort the results of a query. It takes a dictionary where keys are field names and values are either <code>pymongo.ASCENDING</code> (1) or <code>pymongo.DESCENDING</code> (-1) to specify the sort order.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort documents by 'value' in ascending order</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}).sort(<span class="st">"value"</span>, pymongo.ASCENDING):</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Sort documents by 'name' in descending order</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}).sort(<span class="st">"name"</span>, pymongo.DESCENDING):</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="pagination-and-limiting-results">Pagination and Limiting Results</h3>
<p>To limit the number of results returned, use the <code>limit()</code> method of the cursor. To skip a certain number of documents, use the <code>skip()</code> method. This is fundamental for pagination.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit the results to the first 5 documents</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}).limit(<span class="dv">5</span>):</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip the first 5 documents and return the next 5</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}).skip(<span class="dv">5</span>).limit(<span class="dv">5</span>):</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="projection">Projection</h3>
<p>Projection allows you to specify which fields to include or exclude from the results. This is done by providing a second argument to the <code>find()</code> method—a projection dictionary. A value of <code>1</code> includes a field, while <code>0</code> excludes it. The <code>_id</code> field is included by default; to exclude it, explicitly set it to <code>0</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Include only the 'name' and 'value' fields</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({}, {<span class="st">"name"</span>: <span class="dv">1</span>, <span class="st">"value"</span>: <span class="dv">1</span>, <span class="st">"_id"</span>: <span class="dv">0</span>}):</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<h3 id="example-advanced-query-techniques">Example: Advanced Query Techniques</h3>
<p>This example combines multiple advanced query techniques:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find documents where 'value' is between 10 and 20, sort by 'name', limit results to 3, and only return the 'name' field</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc <span class="kw">in</span> collection.find({<span class="st">"value"</span>: {<span class="st">"$gte"</span>: <span class="dv">10</span>, <span class="st">"$lte"</span>: <span class="dv">20</span>}}).sort(<span class="st">"name"</span>, pymongo.ASCENDING).limit(<span class="dv">3</span>).projection({<span class="st">"name"</span>: <span class="dv">1</span>, <span class="st">"_id"</span>: <span class="dv">0</span>}):</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(doc)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This example demonstrates the power of combining query operators, sorting, limiting, and projection for efficient and targeted data retrieval. Remember to populate your collection with appropriate data for this example to produce meaningful output. Always consult the official PyMongo documentation for a complete list of operators and advanced query options.</p>
<h2 id="aggregation-framework">Aggregation Framework</h2>
<h3 id="introduction-to-aggregation">Introduction to Aggregation</h3>
<p>MongoDB’s aggregation framework allows you to process data records and group them into meaningful sets. It’s a powerful tool for performing complex data analysis and transformations directly within the database. Unlike simple queries that return individual documents, aggregation pipelines produce a single result set from multiple operations. PyMongo provides convenient methods for working with the aggregation framework. The core concept involves creating a pipeline of stages, where each stage performs a specific operation on the data, passing the results to the next stage.</p>
<h3 id="aggregation-pipeline-stages">Aggregation Pipeline Stages</h3>
<p>An aggregation pipeline is an array of stages, each represented as a dictionary. Each stage transforms the data flowing through the pipeline. Common stages include:</p>
<ul>
<li><code>$match</code>: Filters the documents based on specified criteria.</li>
<li><code>$project</code>: Selects or reshapes the fields in documents.</li>
<li><code>$group</code>: Groups documents based on a specified key and applies accumulator expressions.</li>
<li><code>$sort</code>: Sorts the documents in the pipeline.</li>
<li><code>$limit</code>: Limits the number of documents passed to the next stage.</li>
<li><code>$skip</code>: Skips a specified number of documents.</li>
<li><code>$unwind</code>: Deconstructs an array field from each input document to output a document for each element. Many other stages exist to handle more complex transformations.</li>
</ul>
<h3 id="match">$match</h3>
<p>The <code>$match</code> stage filters documents based on a query expression. It functions similarly to a <code>find()</code> query but within the aggregation pipeline.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"$match"</span>: { <span class="st">"field"</span>: <span class="st">"value"</span> } }</span></code></pre></div>
<h3 id="project">$project</h3>
<p>The <code>$project</code> stage restructures the documents by selecting, renaming, adding, or removing fields. Field values can be expressed as simple field references or more complex expressions.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"$project"</span>: { <span class="st">"field1"</span>: <span class="dv">1</span>, <span class="st">"field2"</span>: <span class="dv">0</span>, <span class="st">"newField"</span>: { <span class="st">"$add"</span>: [<span class="st">"$fieldA"</span>, <span class="st">"$fieldB"</span>] } } }</span></code></pre></div>
<p>Here, <code>field1</code> is included, <code>field2</code> is excluded, and <code>newField</code> is added, calculated by summing <code>fieldA</code> and <code>fieldB</code>.</p>
<h3 id="group">$group</h3>
<p>The <code>$group</code> stage groups documents together based on a key and applies accumulator expressions to calculate aggregate values for each group.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$group"</span>: {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_id"</span>: <span class="st">"$groupingField"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"totalCount"</span>: { <span class="st">"$sum"</span>: <span class="dv">1</span> },</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sumOfValues"</span>: { <span class="st">"$sum"</span>: <span class="st">"$valueField"</span> }</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This groups by <code>groupingField</code>, counts documents in each group (<code>totalCount</code>), and sums <code>valueField</code> for each group (<code>sumOfValues</code>).</p>
<h3 id="sort">$sort</h3>
<p>The <code>$sort</code> stage sorts the documents in the pipeline based on one or more fields in ascending or descending order. Similar to the <code>sort()</code> method in <code>find()</code>, it uses <code>1</code> for ascending and <code>-1</code> for descending.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"$sort"</span>: { <span class="st">"field"</span>: <span class="dv">1</span> } }</span></code></pre></div>
<h3 id="limit">$limit</h3>
<p>The <code>$limit</code> stage limits the number of documents passed to the next stage.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"$limit"</span>: <span class="dv">10</span> }</span></code></pre></div>
<h3 id="unwind">$unwind</h3>
<p>The <code>$unwind</code> stage deconstructs an array field in each document, outputting a document for each element in the array. This is crucial when processing data with array fields.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"$unwind"</span>: <span class="st">"$arrayField"</span> }</span></code></pre></div>
<h3 id="example-aggregation-framework-usage">Example: Aggregation Framework Usage</h3>
<p>This example demonstrates a complete aggregation pipeline using several stages:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> db[<span class="st">"mycollection"</span>]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> [</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    { <span class="st">"$match"</span>: { <span class="st">"status"</span>: <span class="st">"A"</span> } },  <span class="co"># Match documents with status "A"</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    { <span class="st">"$group"</span>: { <span class="st">"_id"</span>: <span class="st">"$category"</span>, <span class="st">"totalQty"</span>: { <span class="st">"$sum"</span>: <span class="st">"$qty"</span> } } }, <span class="co"># Group by category, sum quantities</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    { <span class="st">"$sort"</span>: { <span class="st">"totalQty"</span>: <span class="op">-</span><span class="dv">1</span> } },  <span class="co"># Sort by total quantity in descending order</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    { <span class="st">"$limit"</span>: <span class="dv">5</span> }  <span class="co"># Limit to top 5 categories</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> <span class="bu">list</span>(collection.aggregate(pipeline))</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This pipeline first filters documents with <code>status</code> “A”, then groups them by <code>category</code> summing quantities, sorts the groups by total quantity, and limits the result to the top 5. Remember to replace <code>"mongodb://localhost:27017/"</code> with your connection string and ensure the collection is populated with data containing <code>status</code> and <code>qty</code> fields (and <code>category</code> for the grouping). This example highlights the power and flexibility of the aggregation framework for complex data analysis. Consult the official PyMongo and MongoDB documentation for a complete understanding of all available stages and their options.</p>
<h2 id="data-modeling">Data Modeling</h2>
<h3 id="choosing-the-right-data-model">Choosing the Right Data Model</h3>
<p>Choosing the optimal data model for your application is crucial for performance and scalability in MongoDB. Unlike relational databases with fixed schemas, MongoDB’s flexible schema allows for various modeling approaches. The best choice depends on your application’s specific needs and query patterns. Consider these factors:</p>
<ul>
<li><p><strong>Query patterns:</strong> How will you typically retrieve data? Will you often need to retrieve related information together (favoring embedding), or will you frequently retrieve individual entities (favoring referencing)?</p></li>
<li><p><strong>Data relationships:</strong> How are different entities related? One-to-one, one-to-many, or many-to-many relationships influence modeling decisions.</p></li>
<li><p><strong>Data volume:</strong> The size and anticipated growth of your data impact the choice between embedding and referencing. Embedding smaller related data within a document is often efficient, but large embedded documents can lead to performance issues.</p></li>
<li><p><strong>Update frequency:</strong> Frequent updates to embedded documents might lead to document bloat and performance problems. Referencing might be better in situations with frequent changes to related data.</p></li>
</ul>
<p>The key is to design a model that minimizes data redundancy, facilitates efficient querying, and optimizes performance for your application’s workload.</p>
<h3 id="embedded-documents-vs.-referencing">Embedded Documents vs.&nbsp;Referencing</h3>
<p>Two primary approaches to modeling relationships are embedding and referencing:</p>
<ul>
<li><p><strong>Embedded Documents:</strong> Related data is included directly within the main document. This is suitable for one-to-one or one-to-few relationships where related data is small and frequently accessed together. It simplifies queries that need to retrieve both the main entity and its related data. However, embedding large amounts of related data can lead to document bloat and performance issues.</p></li>
<li><p><strong>Referencing (or Document References):</strong> Documents refer to each other using object IDs. This is appropriate for one-to-many or many-to-many relationships, especially when related data is large or frequently updated independently. Queries requiring related data will necessitate multiple database operations (joins are not built-in). This adds complexity but improves data modularity and avoids document bloat.</p></li>
</ul>
<p>Choosing between embedding and referencing involves a trade-off between query speed and data size. Careful consideration of query patterns and anticipated data growth is crucial.</p>
<h3 id="data-normalization">Data Normalization</h3>
<p>While MongoDB doesn’t enforce normalization, applying normalization principles can improve data integrity and consistency, especially for larger datasets. Normalization helps reduce redundancy and inconsistencies.</p>
<ul>
<li><p><strong>First Normal Form (1NF):</strong> Eliminate repeating groups of data within a document. Represent arrays of similar items as separate documents referenced from the main document.</p></li>
<li><p><strong>Second Normal Form (2NF):</strong> Eliminate redundant data that depends on only part of the primary key. If a document has a composite key, ensure that non-key attributes depend on the entire key, not just a part of it.</p></li>
<li><p><strong>Third Normal Form (3NF):</strong> Eliminate transitive dependencies. If attribute A depends on attribute B, and attribute B depends on attribute C, then A should not directly depend on C.</p></li>
</ul>
<p>Normalization in MongoDB often involves strategically using referencing to separate related data into individual documents. The level of normalization to apply depends on your specific application requirements and data characteristics. Over-normalization can lead to increased query complexity, while under-normalization can lead to data redundancy and potential inconsistencies. The goal is to find a balance that optimizes both data integrity and query efficiency.</p>
<h2 id="transactions">Transactions</h2>
<h3 id="introduction-to-transactions-in-mongodb">Introduction to Transactions in MongoDB</h3>
<p>Transactions in MongoDB provide atomicity, consistency, isolation, and durability (ACID) properties for operations across multiple documents and collections. Before MongoDB version 4.0, transactions were not directly supported; however, starting with version 4.0, multi-document transactions are available, ensuring that multiple operations either all succeed or all fail as a single unit. This is crucial for maintaining data integrity in applications requiring consistent data modifications. Transactions are managed within a session, ensuring that all operations within that session are treated as a single atomic unit of work. Support for transactions is a significant advancement that enhances the capabilities of MongoDB for complex applications.</p>
<h3 id="using-transactions-with-pymongo">Using Transactions with PyMongo</h3>
<p>PyMongo provides a straightforward way to manage transactions through the <code>client.start_session()</code> method. Transactions are run within a session, and the <code>with client.start_session() as session:</code> context manager ensures proper handling of the session. Within the <code>with</code> block, operations are performed using the <code>session</code> object, and the transaction is implicitly committed upon successful completion of the block or rolled back in case of an error. Error handling is critical; exceptions within the transaction block cause rollback.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> client.start_session() <span class="im">as</span> session:</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> session.start_transaction():</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>            db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>            collection1 <span class="op">=</span> db[<span class="st">"collection1"</span>]</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>            collection2 <span class="op">=</span> db[<span class="st">"collection2"</span>]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>            collection1.insert_one({<span class="st">"x"</span>: <span class="dv">1</span>}, session<span class="op">=</span>session)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>            collection2.insert_one({<span class="st">"y"</span>: <span class="dv">2</span>}, session<span class="op">=</span>session)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">#If any error occurs here, the transaction will be rolled back</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Example of potential error causing rollback:</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">#result = collection2.find_one({"z":3}) #Simulate error by trying to find a non existing entry</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> pymongo.errors.PyMongoError <span class="im">as</span> e:</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Transaction failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="cf">finally</span>:</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    client.close()</span></code></pre></div>
<p>This code uses a <code>try...except...finally</code> block to handle potential errors during transaction processing. The <code>finally</code> block ensures that the client connection is closed regardless of success or failure. Remember to install the appropriate version of PyMongo that supports transactions (version 3.11 or later is recommended for reliable transaction usage).</p>
<h3 id="example-transaction-management">Example: Transaction Management</h3>
<p>This example demonstrates a simple transaction to update multiple documents across two collections consistently:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> client.start_session() <span class="im">as</span> session:</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> session.start_transaction():</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            coll1 <span class="op">=</span> db[<span class="st">"coll1"</span>]</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>            coll2 <span class="op">=</span> db[<span class="st">"coll2"</span>]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            coll1.update_one({<span class="st">"name"</span>: <span class="st">"itemA"</span>}, {<span class="st">"$inc"</span>: {<span class="st">"count"</span>: <span class="dv">1</span>}}, session<span class="op">=</span>session)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            coll2.update_one({<span class="st">"name"</span>: <span class="st">"itemB"</span>}, {<span class="st">"$inc"</span>: {<span class="st">"count"</span>: <span class="op">-</span><span class="dv">1</span>}}, session<span class="op">=</span>session)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> pymongo.errors.PyMongoError <span class="im">as</span> e:</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Transaction failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Transaction completed successfully."</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="cf">finally</span>:</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    client.close()</span></code></pre></div>
<p>This example atomically increments the <code>count</code> field in one document and decrements it in another. If either operation fails, the entire transaction is rolled back, maintaining data consistency. Always handle potential exceptions, and make sure that you’re connecting to a MongoDB server version that supports multi-document transactions (4.0 or later). Using the session and transaction context managers correctly is crucial for reliable transaction management in PyMongo.</p>
<h2 id="error-handling-and-best-practices">Error Handling and Best Practices</h2>
<h3 id="common-errors-and-solutions">Common Errors and Solutions</h3>
<p>Effective error handling is crucial for robust PyMongo applications. Here are some common errors and solutions:</p>
<ul>
<li><p><strong><code>pymongo.errors.ConnectionFailure</code>:</strong> This error occurs when the driver cannot connect to the MongoDB server. Check the server address, port, and network connectivity. Ensure the MongoDB server is running and accessible.</p></li>
<li><p><strong><code>pymongo.errors.ServerSelectionTimeoutError</code>:</strong> A timeout occurred while attempting to connect to the MongoDB server. Increase the connection timeout settings in your <code>MongoClient</code> object or investigate network latency issues.</p></li>
<li><p><strong><code>pymongo.errors.OperationFailure</code>:</strong> This is a general error indicating that a database operation failed. The error message usually provides details about the cause. Check for invalid queries, insufficient permissions, or data validation issues.</p></li>
<li><p><strong><code>pymongo.errors.DuplicateKeyError</code>:</strong> This occurs when attempting to insert a document with a unique key that already exists. Ensure that your application handles this error gracefully, either by preventing duplicate insertions or updating existing documents instead.</p></li>
<li><p><strong><code>pymongo.errors.BulkWriteError</code>:</strong> This error occurs during bulk write operations when some operations fail. The <code>BulkWriteError</code> object provides details about which operations succeeded and failed. Handle the error by examining the results to identify and address individual failures.</p></li>
<li><p><strong><code>pymongo.errors.InvalidName</code>:</strong> Occurs when attempting to use an invalid database or collection name. Ensure names comply with MongoDB naming conventions.</p></li>
</ul>
<p>Always use <code>try...except</code> blocks to handle potential exceptions, providing informative error messages to users or logging details for debugging. PyMongo’s error messages usually provide helpful information about the cause of the error.</p>
<h3 id="best-practices-for-database-design">Best Practices for Database Design</h3>
<p>Effective database design is critical for performance and maintainability:</p>
<ul>
<li><p><strong>Choose appropriate data types:</strong> Use the most efficient data types for your fields. Avoid unnecessarily large data types.</p></li>
<li><p><strong>Design efficient queries:</strong> Optimize queries to minimize the amount of data retrieved and processed. Use indexes strategically to improve query performance.</p></li>
<li><p><strong>Use appropriate indexing:</strong> Indexes significantly impact query performance. Create indexes on frequently queried fields. Avoid over-indexing, which can reduce write performance.</p></li>
<li><p><strong>Schema design:</strong> Design your schemas to minimize data redundancy and improve data consistency. Consider normalization principles to avoid data duplication.</p></li>
<li><p><strong>Data validation:</strong> Implement data validation at the application level to ensure data integrity before it reaches the database.</p></li>
<li><p><strong>Regular monitoring:</strong> Monitor database performance metrics (e.g., query times, disk usage) and adjust your design or configurations as needed.</p></li>
</ul>
<h3 id="connection-pooling-and-management">Connection Pooling and Management</h3>
<p>Connection pooling is essential for efficient database access, especially in applications with multiple concurrent requests. PyMongo’s <code>MongoClient</code> automatically manages a connection pool. By default, the pool size is limited. Consider adjusting the pool size (<code>maxPoolSize</code>) based on your application’s concurrency needs.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>, maxPoolSize<span class="op">=</span><span class="dv">100</span>)</span></code></pre></div>
<p>Properly managing the connection pool avoids excessive connection overhead and enhances application performance. Always close the client connection when finished to release resources: <code>client.close()</code>.</p>
<h3 id="security-considerations">Security Considerations</h3>
<p>Security best practices are vital for protecting your MongoDB data:</p>
<ul>
<li><p><strong>Authentication:</strong> Use authentication to restrict access to your database. Never expose your database credentials in your code or configuration files. Utilize environment variables or secure configuration mechanisms.</p></li>
<li><p><strong>Authorization:</strong> Implement fine-grained access control to limit users’ permissions based on their roles.</p></li>
<li><p><strong>Network Security:</strong> Restrict network access to your MongoDB server only to trusted sources using firewalls and network segmentation.</p></li>
<li><p><strong>Data Encryption:</strong> Encrypt sensitive data both in transit and at rest.</p></li>
<li><p><strong>Regular Security Audits:</strong> Conduct regular security assessments to identify and address potential vulnerabilities.</p></li>
<li><p><strong>Keep Software Updated:</strong> Regularly update your MongoDB server and PyMongo driver to benefit from the latest security patches.</p></li>
<li><p><strong>Input Validation:</strong> Always sanitize user inputs to prevent injection attacks.</p></li>
</ul>
<p>Prioritizing security measures ensures the confidentiality, integrity, and availability of your MongoDB data. Ignoring security can lead to severe data breaches and system compromise.</p>
<h2 id="working-with-gridfs">Working with GridFS</h2>
<h3 id="storing-and-retrieving-files">Storing and Retrieving Files</h3>
<p>GridFS is a specification for storing and retrieving large files in MongoDB. Instead of storing the entire file as a single document, GridFS divides the file into chunks and stores each chunk as a separate document. This approach allows for storing files larger than the BSON document size limit. PyMongo provides convenient methods for interacting with GridFS.</p>
<p><strong>Storing a File:</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo.gridfs <span class="im">import</span> GridFS</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> GridFS(db)  <span class="co"># Get a GridFS instance for the database</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"myfile.txt"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    file_id <span class="op">=</span> fs.put(f, filename<span class="op">=</span><span class="st">"myfile.txt"</span>) <span class="co">#Store file.  'filename' is optional but recommended.</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File stored with ID: </span><span class="sc">{</span>file_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This code opens a file, stores it in GridFS, and prints the generated file ID. Remember to replace <code>"myfile.txt"</code> with the actual path to your file.</p>
<p><strong>Retrieving a File:</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo.gridfs <span class="im">import</span> GridFS</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> GridFS(db)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> fs.get(file_id) <span class="co">#Retrieve file by ID</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"retrieved_file.txt"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    f.write(<span class="bu">file</span>.read()) <span class="co">#Write file content</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File retrieved successfully."</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This code retrieves the file using its ID and writes the content to a new file.</p>
<h3 id="chunking-and-file-management">Chunking and File Management</h3>
<p>GridFS automatically handles chunking. You don’t need to manage chunks directly. The <code>chunkSize</code> parameter in the <code>GridFS</code> constructor controls the chunk size (default is 255 KB). Larger chunk sizes generally improve read performance but increase the risk of data loss if a chunk is corrupted. Smaller chunk sizes increase the number of chunks, potentially impacting performance slightly.</p>
<p><strong>Deleting a File:</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo.gridfs <span class="im">import</span> GridFS</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> GridFS(db)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>fs.delete(file_id) <span class="co"># Delete file by ID</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File deleted successfully."</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This deletes the specified file from GridFS.</p>
<p><strong>Listing Files:</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pymongo.gridfs <span class="im">import</span> GridFS</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(<span class="st">"mongodb://localhost:27017/"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> GridFS(db)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> fs.find():</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">file</span>.filename, <span class="bu">file</span>.length) <span class="co"># Access file metadata</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p>This iterates through the files in GridFS, printing the filename and file length.</p>
<p>GridFS provides a robust mechanism for managing large files in MongoDB. Choosing the appropriate chunk size is important for balancing performance and resilience, but generally doesn’t require direct interaction with individual chunks in most use cases. Always handle potential exceptions during file operations, providing user-friendly error messages and robust logging. Remember to close your client connection when finished to release resources efficiently.</p>
<h2 id="working-with-mongodb-atlas">Working with MongoDB Atlas</h2>
<h3 id="connecting-to-atlas">Connecting to Atlas</h3>
<p>Connecting to a MongoDB Atlas cluster from your PyMongo application involves using a connection string that includes authentication details and cluster information. The connection string format is similar to connecting to a local MongoDB instance, but with additional parameters for authentication and cluster specification.</p>
<p>The simplest connection string uses the standard MongoDB URI format:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymongo</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace with your Atlas connection string</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>atlas_connection_string <span class="op">=</span> <span class="st">"mongodb+srv://&lt;username&gt;:&lt;password&gt;@&lt;cluster-address&gt;/&lt;database&gt;?retryWrites=true&amp;w=majority"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> pymongo.MongoClient(atlas_connection_string)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Access a database</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> client[<span class="st">"mydatabase"</span>]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ... perform database operations ...</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>client.close()</span></code></pre></div>
<p><strong>Important:</strong> Replace the placeholders <code>&lt;username&gt;</code>, <code>&lt;password&gt;</code>, <code>&lt;cluster-address&gt;</code>, and <code>&lt;database&gt;</code> with your actual Atlas credentials and cluster details. You’ll find your connection string in the MongoDB Atlas console under your cluster’s “Connect” section. Always prioritize using environment variables instead of hardcoding credentials in your source code.</p>
<p>You might need to adjust your firewall rules in the Atlas console to allow connections from your application’s IP address.</p>
<h3 id="using-atlas-features">Using Atlas Features</h3>
<p>MongoDB Atlas offers various features that enhance database management and application development. PyMongo interacts seamlessly with many of these features:</p>
<ul>
<li><p><strong>Data Lake:</strong> Atlas Data Lake allows you to export data to various cloud storage options. PyMongo interacts with your Atlas cluster for data retrieval, but the export functionality is managed within the Atlas console itself.</p></li>
<li><p><strong>Time Series Collections:</strong> Efficiently store and query time-stamped data. PyMongo’s interaction with time series collections remains largely the same as with regular collections, but the optimized indexing and query capabilities within Atlas enhance performance significantly.</p></li>
<li><p><strong>Search:</strong> Atlas Search offers a robust search functionality. While PyMongo handles database interactions, the search capabilities are utilized through the Atlas Search APIs directly and not necessarily within PyMongo itself.</p></li>
<li><p><strong>Change Streams:</strong> Monitor data changes in real time. PyMongo provides methods to interact with change streams, enabling you to build applications that react to database updates instantly.</p></li>
<li><p><strong>Data Backup and Restore:</strong> Atlas handles automatic backups. Data restore is managed in the Atlas console; PyMongo primarily interacts with the restored data after restoration is complete.</p></li>
</ul>
<p>Leverage these Atlas features to improve your application’s data management, performance, and scalability. Always consult the MongoDB Atlas documentation to understand how to integrate and use specific features efficiently.</p>
<h3 id="managing-your-atlas-cluster">Managing your Atlas Cluster</h3>
<p>MongoDB Atlas provides a user-friendly web interface for managing your cluster. Some key management tasks include:</p>
<ul>
<li><p><strong>Scaling:</strong> Adjust the cluster’s resources (shards, nodes, memory) based on your application’s needs. This is done entirely within the Atlas console.</p></li>
<li><p><strong>Security:</strong> Configure network access, authentication methods, and user roles.</p></li>
<li><p><strong>Monitoring:</strong> Track key metrics like CPU usage, storage, and query performance.</p></li>
<li><p><strong>Backups:</strong> Configure and manage backups for disaster recovery.</p></li>
<li><p><strong>Alerting:</strong> Set up alerts for critical events.</p></li>
<li><p><strong>Deployment:</strong> Create and manage your MongoDB deployment.</p></li>
</ul>
<p>PyMongo interacts with your deployed database, not with the cluster management functions. The Atlas console is the primary interface for managing and configuring your Atlas cluster. Regular monitoring and proactive resource management are vital for maintaining an optimally performing and highly available database service.</p>
<h2 id="appendix-pymongo-api-reference">Appendix: PyMongo API Reference</h2>
<p>This section provides a brief overview of key PyMongo API components. For complete and up-to-date information, refer to the official PyMongo documentation.</p>
<h3 id="client">Client</h3>
<p>The <code>MongoClient</code> object is the entry point for interacting with a MongoDB server. It manages connections and provides access to databases.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><p><code>__init__(host, port=None, ...)</code>: Constructor to create a <code>MongoClient</code> instance. The <code>host</code> parameter specifies the server address (can be a connection string). Optional parameters include authentication credentials, connection pool settings (<code>maxPoolSize</code>, <code>minPoolSize</code>, etc.), and various other connection options.</p></li>
<li><p><code>list_database_names()</code>: Returns a list of database names accessible to the connected user.</p></li>
<li><p><code>drop_database(name)</code>: Drops the specified database.</p></li>
<li><p><code>get_database(name)</code>: Returns a <code>Database</code> object for the specified database. Creates the database if it doesn’t exist (but doesn’t create it if it doesn’t exist and is called only).</p></li>
<li><p><code>close()</code>: Closes the connection to the MongoDB server. It’s crucial to call this method when finished to release resources.</p></li>
<li><p><code>start_session()</code>: Begins a client session (important for transaction management).</p></li>
</ul>
<h3 id="database">Database</h3>
<p>The <code>Database</code> object represents a MongoDB database. It provides access to collections within that database.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><p><code>__init__(client, name)</code>: Constructor to create a <code>Database</code> instance. <code>client</code> is the <code>MongoClient</code> object, and <code>name</code> is the database name.</p></li>
<li><p><code>list_collection_names()</code>: Returns a list of collection names within the database.</p></li>
<li><p><code>drop_collection(name)</code>: Drops the specified collection.</p></li>
<li><p><code>create_collection(name, **kwargs)</code>: Creates a new collection with optional parameters (e.g., <code>capped</code> for capped collections, <code>size</code>, <code>max</code>).</p></li>
<li><p><code>get_collection(name)</code>: Returns a <code>Collection</code> object for the specified collection.</p></li>
</ul>
<h3 id="collection">Collection</h3>
<p>The <code>Collection</code> object represents a MongoDB collection. It provides methods for interacting with the documents within the collection.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><p><code>__init__(database, name)</code>: Constructor to create a <code>Collection</code> instance. <code>database</code> is the <code>Database</code> object, and <code>name</code> is the collection name.</p></li>
<li><p><code>insert_one(document, **kwargs)</code>: Inserts a single document.</p></li>
<li><p><code>insert_many(documents, **kwargs)</code>: Inserts multiple documents.</p></li>
<li><p><code>find(filter=None, projection=None, **kwargs)</code>: Returns a <code>Cursor</code> object for querying documents. <code>filter</code> specifies the query criteria, and <code>projection</code> specifies which fields to include or exclude.</p></li>
<li><p><code>find_one(filter=None, projection=None, **kwargs)</code>: Returns a single document matching the query.</p></li>
<li><p><code>update_one(filter, update, **kwargs)</code>: Updates a single document.</p></li>
<li><p><code>update_many(filter, update, **kwargs)</code>: Updates multiple documents.</p></li>
<li><p><code>replace_one(filter, replacement, **kwargs)</code>: Replaces a single document.</p></li>
<li><p><code>delete_one(filter, **kwargs)</code>: Deletes a single document.</p></li>
<li><p><code>delete_many(filter, **kwargs)</code>: Deletes multiple documents.</p></li>
<li><p><code>aggregate(pipeline, **kwargs)</code>: Executes an aggregation pipeline.</p></li>
</ul>
<h3 id="cursor">Cursor</h3>
<p>The <code>Cursor</code> object represents the result set of a query. It allows you to efficiently iterate through documents.</p>
<p><strong>Key Methods:</strong></p>
<ul>
<li><p><code>next()</code>: Retrieves the next document in the result set.</p></li>
<li><p><code>__iter__()</code>: Allows for iterating through the cursor using a <code>for</code> loop.</p></li>
<li><p><code>limit(n)</code>: Limits the number of documents returned.</p></li>
<li><p><code>skip(n)</code>: Skips the first <code>n</code> documents.</p></li>
<li><p><code>sort(key_or_list, direction=None)</code>: Sorts the documents.</p></li>
<li><p><code>count()</code> : Returns the total number of documents.</p></li>
</ul>
<h3 id="helper-functions">Helper Functions</h3>
<p>PyMongo provides various helper functions, including those for working with GridFS (<code>GridFS</code>, <code>GridOut</code>, etc.), ObjectId creation (<code>ObjectId()</code>), and date/time handling. Refer to the official PyMongo documentation for detailed information on these helper functions and their usage. The helper functions streamline common database operations and enhance code readability.</p>
<p>This is not an exhaustive list, but covers the essential methods of the core PyMongo classes. Always consult the official PyMongo documentation for the most complete and up-to-date information on the API and its usage.</p>


<footer>Copyright 2025 - Muthukrishnan</footer>
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3609399560636561" crossorigin="anonymous"></script>




</body></html>